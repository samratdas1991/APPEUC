<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e58b-f438-8000-5262-1bef901bef90_723136</versionUuid>
    <interface>
        <name>EAP_ManageProcessUserGridField</name>
        <uuid>_a-0000e4cd-1af4-8000-5255-1bef901bef90_150813</uuid>
        <description>holds the grid to manage process users in admin console</description>
        <parentUuid>_a-0000e4c3-7a1b-8000-524f-1bef901bef90_6580</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  local!cluster,
  local!search,
  local!subCluster,
  local!processId,
  local!data: #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_12194"(
    search: local!search,
    pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(
      startIndex: 1,
      batchSize: - 1,
      sort: #"SYSTEM_SYSRULES_sortInfo"(
        field: "created_on",
        ascending: true()
      )
    ),
    clusterId: local!cluster,
    subClusterId: local!subCluster,
    isAllFields: true()
  ),
  local!clusterData: #"_a-0000e4c6-4628-8000-5253-1bef901bef90_16958"(
    pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(
      startIndex: 1,
      batchSize: - 1,
      sort: #"SYSTEM_SYSRULES_sortInfo"(
        field: "name",
        ascending: true()
      )
    )
  ),
  local!subClusterData: #"_a-0000e4c6-4628-8000-5253-1bef901bef90_17680"(
    clusterId: local!cluster,
    pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(
      startIndex: 1,
      batchSize: - 1,
      sort: #"SYSTEM_SYSRULES_sortInfo"(
        field: "name",
        ascending: true()
      )
    )
  ),
  local!activeStep: 0,
  local!isInvalid: 1,
  local!tempUser: #"_a-0000e56b-0831-8000-5261-1bef901bef90_711902"(
    processId: local!processId
  ),
  local!finalTemp: #"_a-0000e56b-0831-8000-5261-1bef901bef90_711929"(
    processId: local!processId,
    tempRefProcessUsers: local!tempUser
  ),
  local!validusers: reject(
    fn!isnull,
    #"SYSTEM_SYSRULES_forEach"(
      items: index(
        local!finalTemp,
        "userSoeId",
        {}
      ),
      expression: if(
        #"_a-0000e58b-f438-8000-5262-1bef901bef90_722585"(
          userSOEID: fv!item
        ),
        fv!item,
        null
      )
     
      
    )
  ),
  local!inValidUsers: reject(
    fn!isnull,
    #"SYSTEM_SYSRULES_forEach"(
      items: index(
        local!finalTemp,
        "userSoeId",
        {}
      ),
      expression: if(
        #"_a-0000e58b-f438-8000-5262-1bef901bef90_722585"(
          userSOEID: fv!item
        ),
        null,
        fv!item
      )
      
    )
  ),
  local!InvalidUserData: index(
    local!finalTemp,
    wherecontains(
      touniformstring(
        local!inValidUsers
      ),
      touniformstring(
        index(
          local!finalTemp,
          "userSoeId",
          {}
        )
      )
    ),
    {}
  ),
  local!validuserData: index(
    local!finalTemp,
    wherecontains(
      touniformstring(
        local!validusers
      ),
      touniformstring(
        index(
          local!finalTemp,
          "userSoeId",
          {}
        )
      )
    ),
    {}
  ),
  local!verifyValidUserData: reject(
    fn!isnull,
    #"SYSTEM_SYSRULES_forEach"(
      items: local!validuserData,
      expression: if(
        and(
          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
            index(
              fv!item,
              "isExpectedMaker",
              {}
            )
          ) = true(),
          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
            index(
              fv!item,
              "isExpectedChecker",
              {}
            )
          ) = true(),
          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
            index(
              fv!item,
              "isExpectedPowerUser",
              {}
            )
          ) = true()
        ),
        fv!item,
        null
      )
    )
  ),
  local!verifyValidUserGroupData: reject(
    fn!isnull,
    #"SYSTEM_SYSRULES_forEach"(
      items: local!validuserData,
      expression: if(
        and(
          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
            index(
              fv!item,
              "isExpectedMaker",
              {}
            )
          ) = true(),
          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
            index(
              fv!item,
              "isExpectedChecker",
              {}
            )
          ) = true(),
          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
            index(
              fv!item,
              "isExpectedPowerUser",
              {}
            )
          ) = true()
        ),
        null,
        fv!item
      )
    )
  ),
  local!ValidGroup: #"_a-0000e58b-f438-8000-5262-1bef901bef90_719203"(
    processId: local!processId
  ),
  {
    #"SYSTEM_SYSRULES_sectionLayout_v1"(
      label: "Manage Process Groups &amp; Users" &amp; if(
        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
          ri!processId
        ),
        {},
        {
          "|" &amp; index(
            #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_12194"(
              processId: ri!processId
            ),
            "name",
            {}
          )
        }
      ),
      contents: {
        #"SYSTEM_SYSRULES_columnsLayout"(
          columns: {
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: #"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_285963"(
                label: "",
                placeHolder: "Search",
                refreshAfter: "KEYPRESS",
                value: local!search,
                saveInto: local!search,
                showWhen: local!activeStep = 0
              )
            ),
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: #"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_287171"(
                label: "",
                placeholderLabel: "--select cluster--",
                choiceLabels: index(
                  local!clusterData,
                  "name",
                  {}
                ),
                choiceValues: index(
                  local!clusterData,
                  "cluster_id",
                  {}
                ),
                value: local!cluster,
                saveInto: {
                  local!cluster,
                  a!save(
                    local!subCluster,
                    null
                  )
                },
                showWhen: local!activeStep = 0
              )
            ),
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: #"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_287171"(
                label: "",
                placeholderLabel: "--select sub-cluster--",
                choiceLabels: index(
                  local!subClusterData,
                  "name",
                  {}
                ),
                choiceValues: index(
                  local!subClusterData,
                  "sub_cluster_id",
                  {}
                ),
                value: local!subCluster,
                saveInto: local!subCluster,
                showWhen: local!activeStep = 0
              )
            )
          }
        ),
        if(
          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
            local!data
          ),
          #"SYSTEM_SYSRULES_richTextDisplayField"(
            value: #"SYSTEM_SYSRULES_richTextItem_v1"(
              text: "No Process User Detail",
              color: "SECONDARY",
              size: "MEDIUM_PLUS",
              style: {
                "STRONG",
                "EMPHASIS"
              }
            ),
            showWhen: or(
              tointeger(
                local!activeStep
              ) = 0
            ),
            align: "CENTER"
          ),
          #"SYSTEM_SYSRULES_gridField_v1"(
            label: "",
            data: local!data,
            columns: {
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Euc Reference Number",
                value: fv!row.euc_reference_number,
                align: "END",
                sortField: "euc_reference_number"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Process Id",
                value: fv!row.process_id,
                align: "END",
                sortField: "process_id"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Process Name",
                value: fv!row.name,
                sortField: "name"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Cluster Name",
                value: index(
                  #"_a-0000e4c6-4628-8000-5253-1bef901bef90_16958"(
                    clusterId: fv!row.cluster_id
                  ),
                  "name",
                  null
                )
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Sub Cluster Name",
                value: index(
                  #"_a-0000e4c6-4628-8000-5253-1bef901bef90_17680"(
                    subClusterId: fv!row.sub_cluster_id
                  ),
                  "name",
                  null
                )
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Edit",
                value: #"SYSTEM_SYSRULES_richTextDisplayField"(
                  value: {
                    #"SYSTEM_SYSRULES_richTextIcon"(
                      icon: "edit",
                      caption: "Edit",
                      link: if(
                        tointeger(
                          local!activeStep
                        ) = 0,
                        #"SYSTEM_SYSRULES_dynamicLink"(
                          value: 1,
                          saveInto: {
                            a!save(
                              local!activeStep,
                              save!value
                            ),
                            a!save(
                              ri!processId,
                              fv!row.process_id
                            ),
                            a!save(
                              local!processId,
                              fv!row.process_id
                            ),
                            a!save(
                              ri!refProcessGroup,
                              #"_a-0000e4c6-4628-8000-5253-1bef901bef90_17287"(
                                processId: ri!processId,
                                
                              )
                            ),
                            a!save(
                              ri!refProcessUser,
                              #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_9887"(
                                processId: ri!processId
                              )
                            )
                          }
                        ),
                        {}
                      ),
                      linkStyle: "STANDALONE",
                      color: if(
                        tointeger(
                          local!activeStep
                        ) = 0,
                        "ACCENT",
                        "SECONDARY"
                      ),
                      size: "MEDIUM_PLUS"
                    )
                  },
                  align: "CENTER"
                )
              )
            },
            shadeAlternateRows: false(),
            pageSize: 10,
            showWhen: local!activeStep = 0,
            instructions: "Click on edit link to manage"
          )
        )
      },
      divider: "ABOVE"
    ),
    #"SYSTEM_SYSRULES_columnsLayout"(
      columns: {
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            if(
              #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                ri!processId
              ),
              {},
              {
                #"_a-0000e4cd-1af4-8000-5255-1bef901bef90_125174"(
                  refProcessGroup: local!ValidGroup,
                  relatedAction: 2,
                  isReadOnly: false()
                ),
                #"_a-0000e58b-f438-8000-5262-1bef901bef90_717505"(
                  refProcessGroup: ri!refProcessGroup,
                  processId: local!processId,
                  refProcessUser: ri!refProcessUser,
                  validGroupAndUser: local!verifyValidUserData,
                  invalidUsers: local!InvalidUserData,
                  validUser: local!verifyValidUserGroupData,
                  isInvalid: local!isInvalid
                )
              }
            )
          }
        )
      },
      showWhen: local!activeStep = 1
    ),
    #"SYSTEM_SYSRULES_ButtonLayout"(
      primaryButtons: {
        if(
          local!activeStep = 0,
          #"SYSTEM_SYSRULES_ButtonWidget"(
            label: #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[1],
            value: #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[1],
            saveInto: ri!buttonAction,
            submit: true(),
            style: "NORMAL",
            validate: true()
          ),
          #"SYSTEM_SYSRULES_ButtonWidget"(
            label: #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[4],
            value: #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[4],
            saveInto: {
              ri!buttonAction,
              a!save(
                ri!refProcessGroup,
                local!ValidGroup
              ),
              a!save(
                ri!refProcessUser,
                append(
                  append(
                    local!verifyValidUserData,
                    local!InvalidUserData
                  ),
                  #"SYSTEM_SYSRULES_forEach"(
                    items: local!verifyValidUserGroupData,
                    expression: #"_a-0000e4cd-1af4-8000-5255-1bef901bef90_85189"(
                      processUserId: fv!item.processUserId,
                      processId: fv!item.ProcessId,
                      userSoeId: fv!item.userSoeId,
                      isPrimaryMaker: if(
                        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                          fv!item.isExpectedMaker
                        ),
                        fv!item.isPrimaryMaker,
                        fv!item.isExpectedMaker
                      ),
                      isSecondaryMaker: if(
                        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                          fv!item.isExpectedMaker
                        ),
                        fv!item.isSecondaryMaker,
                        fv!item.isExpectedMaker
                      ),
                      isPrimaryChecker: if(
                        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                          fv!item.isExpectedChecker
                        ),
                        fv!item.isPrimaryChecker,
                        fv!item.isExpectedChecker
                      ),
                      isSecondaryChecker: if(
                        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                          fv!item.isExpectedChecker
                        ),
                        fv!item.isSecondaryChecker,
                        fv!item.isExpectedChecker
                      ),
                      isAuditor: fv!item.isAuditor,
                      isPowerUser: if(
                        and(
                          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                            fv!item.isExpectedChecker
                          ),
                          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                            fv!item.isExpectedMaker
                          )
                        ),
                        fv!item.isDoa,
                        if(
                          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                            fv!item.isExpectedChecker
                          ),
                          fv!item.isExpectedMaker,
                          fv!item.isExpectedChecker
                        )
                      ),
                      isViewer: fv!item.isViewer,
                      createdBy: fv!item.createdBy,
                      updatedBy: fv!item.updatedBy,
                      updatedOn: fv!item.updatedOn,
                      isActive: fv!item.isActive,
                      createdOn: fv!item.createdOn,
                      isDoa: if(
                        and(
                          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                            fv!item.isExpectedChecker
                          ),
                          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                            fv!item.isExpectedMaker
                          )
                        ),
                        fv!item.isDoa,
                        if(
                          #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                            fv!item.isExpectedChecker
                          ),
                          fv!item.isExpectedMaker,
                          fv!item.isExpectedChecker
                        )
                      )
                    )
                  )
                )
              ),
              
            },
            submit: true(),
            style: "NORMAL",
            validate: true()
          )
        )
      },
      secondaryButtons: #"SYSTEM_SYSRULES_ButtonWidget"(
        label: if(
          local!activeStep = 0,
          #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[2],
          #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[7]
        ),
        value: if(
          local!activeStep = 0,
          #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[2],
          #"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[7]
        ),
        saveInto: {
          ri!buttonAction,
          a!save(
            ri!processId,
            null
          )
        },
        submit: true(),
        style: "NORMAL",
        validate: false()
      )
    )
  }
)</definition>
        <namedTypedValue>
            <name>processId</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>refProcessUser</name>
            <type>
                <name>EAP_T_RefProcessUsers?list</name>
                <namespace>urn:com:appian:types:EAP</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>buttonAction</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>refProcessGroup</name>
            <type>
                <name>EAP_T_RefProcessGroup</name>
                <namespace>urn:com:appian:types:eap</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <history>
        <historyInfo versionUuid="_a-0000e4cd-1af4-8000-5255-1bef901bef90_169308"/>
        <historyInfo versionUuid="_a-0000e4cd-1af4-8000-5255-1bef901bef90_176318"/>
        <historyInfo versionUuid="_a-0000e4cd-1af4-8000-5255-1bef901bef90_187758"/>
        <historyInfo versionUuid="_a-0000e4e2-51bd-8000-d8ec-a7ef90a7ef90_1424679"/>
        <historyInfo versionUuid="_a-0000e4dd-0d8b-8000-5257-1bef901bef90_231347"/>
        <historyInfo versionUuid="_a-0000e4e9-ef8d-8000-5259-1bef901bef90_323545"/>
        <historyInfo versionUuid="_a-0000e58b-f438-8000-5262-1bef901bef90_719380"/>
        <historyInfo versionUuid="_a-0000e58b-f438-8000-5262-1bef901bef90_723136"/>
    </history>
</contentHaul>
