<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e5ea-27a1-8000-5269-1bef901bef90_774642</versionUuid>
    <rule>
        <name>EAP_getExportableDataForReportTracibilityAndAuditMislestone</name>
        <uuid>_a-0000e5c3-a65f-8000-5268-1bef901bef90_761513</uuid>
        <description>Hold rule to get export to excel for tracibility report</description>
        <parentUuid>_a-0000e4c3-7a1b-8000-524f-1bef901bef90_6574</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>with(
  local!json: #"SYSTEM_SYSRULES_fromJson"(
    ri!input
  ),
 local!paginfInfo:#"SYSTEM_SYSRULES_pagingInfo"(
   startIndex:1,
   batchSize:#"_a-0000e56b-0831-8000-5261-1bef901bef90_694158"
 ),
 
 local!FilteredData: a!flatten(index(#"_a-0000e5c3-a65f-8000-5268-1bef901bef90_759350"(
   
   
   rowLimit: #"_a-0000e56b-0831-8000-5261-1bef901bef90_694158",
   centerSegMappingId:local!json.CENTER_SEG_MAPPING_ID,
   makers: local!json.MAKERS,
   checkers:local!json.CHECKERS,
   eucNumber: local!json.EUC_NUMBER,
   centerId: local!json.CENTER_ID,
   mgdSegL7Id:local!json.MGDSEGL7_ID,
   mgdSegL8Id: local!json.MGDSEGL8_ID,
   periodFrom:local!json.PERIOD_FROM,
   periodTo:local!json.PERIOD_TO,
   status:local!json.STATUS
 ),"P_OUTPUT1",{})),

local!newData:apply(
  #"_a-0000e5c3-a65f-8000-5268-1bef901bef90_761201"( 
    centerName:_,
    l7DisplayName:_,
    l8DisplayName:_, 
    eucId:_, 
    eucName:_,
    recurrenceType:_, 
    startTriggerDatetimeGMT:_,
    endTriggerDatetimeGMT:_,
    endTriggerDatetime:_,
    startTriggerDatetime:_,
    endBD:_, 
    startBD:_,
    makers:_, 
    checkers:_,
    timezoneId:_,  
    processActtualStartTime:_,
    processEndTime:_,
    totalProcessingTime:_,
    processAgeing:_,
    status:_,
    stepId:_,
    stepName:_,
    milestoneName:_,
    startTime:_,
    competionTime:_,
    milestoneStatus:_,
    output1MilestoneName:_, 
    output1SystemTypeCode:_,
    output1LookupSystemTypeCode:_, 
    output1ConfigDataName:_, 
    output1AppianDocumentIdFileName:_, 
    output1Comment:_, 
    output1StartTime:_, 
    output1EndTime:_, 
    output1Status:_,
    output2MilestoneName:_, 
    output2ParsingFileConfigName:_, 
    output2Comment:_,
    output2StartTime:_, 
    output2Status:_, 
    output3MilestoneName:_, 
    output3AppianDocumentId:_, 
    output3AppianDocumentIdFileNameWorkingFile:_,
    output3Comment:_, 
    output3StartTime:_, 
    output3EndTime:_,
    output3Status:_, 
    output4MilestoneName:_, 
    output4AppianDocumentId:_, 
    output4AppianDocumentIdFileNameWorkingFile:_,
    output4StartTime:_,
    output4EndTime:_, 
    output4Status:_, 
    output4Comment:_, 
    output5MilestoneName:_, 
    output5FileConfigName:_, 
    output5AppianBaseTemplateDocIdFileNameOutputFile:_,
    output5Comment:_, 
    output5StartTime:_,
    output5EndTime:_, 
    output5Status:_, 
    output6MilestoneName:_, 
    output6SystemTypeCode:_, 
    output6LookupSystemTypeCode:_, 
    output6ConfigDataName:_,
    output6AppianDocumentIdFileName:_, 
    output6Comment:_, 
    output6StartTime:_, 
    output6EndTime:_,
    output6Status:_,
    output7MilestoneName:_, 
    output7Comment:_, 
    output7StartTime:_,
    output7EndTime:_,
    output7Status:_, 
    output8MilestoneName:_,
    output8Comment:_,
    output8StartTime:_,
    output8EndTime:_,
    output8Status:_
  ),
  merge(
    {
      index(local!FilteredData,"CENTER_NAME",{})
    },
    {
      index(local!FilteredData,"L7_DISPLAY_NAME",{})
    },
    {
      index(local!FilteredData,"L8_DISPLAY_NAME",{})
    },
    {
      index(local!FilteredData,"EUC_ID",{})
    },
    {
      index(local!FilteredData,"EUC_NAME",{})
    },
    {
      index(local!FilteredData,"RECURRENCE_TYPE",{})
    },
    {
      index(local!FilteredData,"START_TRIGGER_DATETIME_GMT",{})
    },
    {
      index(local!FilteredData,"END_TRIGGER_DATETIME_GMT",{})

    },
    {
      index(local!FilteredData,"END_TRIGGER_DATETIME",{})
    },
    {
      index(local!FilteredData,"START_TRIGGER_DATETIME",{})
    },
    {
      index(local!FilteredData,"END_BD",{})
    },
    {
      index(local!FilteredData,"START_BD",{}),

    },
    {
      index(local!FilteredData,"MAKERS",{})
    }, 
    {
      index(local!FilteredData,"CHECKERS",{})
    },
    {
      index(local!FilteredData,"TIMEZONE_ID",{})
    }, 
    {
      index(local!FilteredData,"PROCESS_ACTTUAL_START_TIME",{})
    },
    {
      index(local!FilteredData,"PROCESS_END_TIME",{})
    },
    {
      index(local!FilteredData,"TOTAL_PROCESSING_TIME",{})
    },
    {
      index(local!FilteredData,"PROCESS_AGEING",{})
    },
    {
      index(local!FilteredData,"STATUS",{})
    },
    {
      index(local!FilteredData,"STEP_ID",{})
    },
    {
      index(local!FilteredData,"STEP_NAME",{})
    },
    {
      index(local!FilteredData,"MILESTONE_NAME",{})
    },
    {
      index(local!FilteredData,"START_TIME",{})
    },
    {
      index(local!FilteredData,"COMPETION_TIME",{})
    },
    {
      index(local!FilteredData,"MILESTONE_STATUS",{})
    },
    {
      index(local!FilteredData,"OUTPUT_1_MILESTONE_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_1_SYSTEM_TYPE_CODE",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_1_LOOKUP_SYSTEM_TYPE_CODE",{})
    },
    {
      index(local!FilteredData,"OUTPUT_1_CONFIG_DATA_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_1_APPIAN_DOCUMENT_ID (FILE_NAME)",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_1_COMMENT",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_1_START_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_1_END_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_1_STATUS",{})
    },
    {
      index(local!FilteredData,"OUTPUT_2_MILESTONE_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_2_PARSING_FILE_CONFIG_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_2_COMMENT",{})
    },
    {
      index(local!FilteredData,"OUTPUT_2_START_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_2_STATUS",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_3_MILESTONE_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_3_APPIAN_DOCUMENT_ID",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_3_APPIAN_DOCUMENT_ID (FILE_NAME WORKING FILE)",{})
    },
    {
      index(local!FilteredData,"OUTPUT_3_COMMENT",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_3_START_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_3_END_TIME",{})
    },
    {
      index(local!FilteredData,"OUTPUT_3_STATUS",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_4_MILESTONE_NAME",{})
    },
    {
      index(local!FilteredData,"OUTPUT_4_APPIAN_DOCUMENT_ID",{})
    },
    {
      index(local!FilteredData,"OUTPUT_4_APPIAN_DOCUMENT_ID (FILE_NAME WORKING FILE)",{})
    },
    {
      index(local!FilteredData,"OUTPUT_4_START_TIME",{})
    },
    {
      index(local!FilteredData,"OUTPUT_4_END_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_4_STATUS",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_4_COMMENT",{})
    },
    {
      index(local!FilteredData,"OUTPUT_5_MILESTONE_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_5_FILE_CONFIG_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_5_APPIAN_BASE_TEMPLATE_DOC_ID (FILE_NAME OUTPUT FILE)",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_5_COMMENT",{})
    },  
    {
      index(local!FilteredData,"OUTPUT_5_START_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_5_END_TIME",{})
    },  
    {
      index(local!FilteredData,"OUTPUT_5_STATUS",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_6_MILESTONE_NAME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_6_SYSTEM_TYPE_CODE",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_6_LOOKUP_SYSTEM_TYPE_CODE",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_6_CONFIG_DATA_NAME",{})
    },
    {
      index(local!FilteredData,"OUTPUT_6_APPIAN_DOCUMENT_ID (FILE_NAME)",{})
    },
    {
      index(local!FilteredData,"OUTPUT_6_COMMENT",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_6_START_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_6_END_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_6_STATUS",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_7_MILESTONE_NAME",{})
    },  
    {
      index(local!FilteredData,"OUTPUT_7_COMMENT",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_7_START_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_7_END_TIME",{})
    }, 
    {
      index(local!FilteredData,"OUTPUT_7_STATUS",{})
    },
    {
      index(local!FilteredData,"OUTPUT_8_MILESTONE_NAME",{})
    },
    {
      index(local!FilteredData,"OUTPUT_8_COMMENT",{})
    },
    {
      index(local!FilteredData,"OUTPUT_8_START_TIME",{})
    },
    {
      index(local!FilteredData,"OUTPUT_8_END_TIME",{})
    },
    {
      index(local!FilteredData,"OUTPUT_8_STATUS",{})
    }
 
    
  )
),

  local!DataSubset: todatasubset(
    local!newData,
    local!paginfInfo
  ),
  local!output:'type!{urn:com:appian:ps:excel:types}ExportableDataSubset'(
    filename: concat(
      "Tracibility Report - ",
      loggedInUser()," - ",
      text(
        now(),
        "_ddmmyyyy_hhmmss"
      )
    ),
    fieldNames: {
      "euc_id",
      "euc_name",
      "start_bd",
      "end_bd",
      "makers",
      "checkers",
      "status",
      "process_acttual_start_time",
      "process_ageing",
      "process_end_time",
      "total_processing_time",
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[2]),
        "center_name",{}
      ),
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[4]),
        "l8_display_name",{}
      ),
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[3]),
        "l7_display_name",{}
      ),
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[17]),
        "start_trigger_datetime",{}
      ),
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[18]),
        "end_trigger_datetime",{}
      ), 
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[19]),
        "start_trigger_datetime_gmt",{}
      ),
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[20]),
        "end_trigger_datetime_gmt",{}
      ),
      "step_id",
      "step_name",
      "milestone_name",
      "start_time",
      "competion_time",
      "milestone_status",
      "output_1_milestone_name",
      "output_1_system_type_code",
      "output_1_lookup_system_type_code",
      "output_1_config_data_name",
      "output_1_appian_document_id_file_name",
      "output_1_comment",
      "output_1_start_time",
      "output_1_end_time",
      "output_1_status",
      "output_2_milestone_name",
      "output_2_parsing_file_config_name",
      "output_2_comment",
      "output_2_start_time",
      "output_2_status",
      "output_3_milestone_name",
      "output_3_appian_document_id",
      "output_3_appian_document_id_file_name_working_file",
      "output_3_comment",
      "output_3_start_time",
      "output_3_end_time",
      "output_3_status",
      "output_4_milestone_name",
      "output_4_appian_document_id",
      "output_4_appian_document_id_file_name_working_file",
      "output_4_comment",
      "output_4_start_time",
      "output_4_end_time",
      "output_4_status",
      "output_5_milestone_name",
      "output_5_file_config_name",
      "output_5_appian_base_template_doc_id_file_name_output_file",
      "output_5_comment",
      "output_5_start_time",
      "output_5_end_time",
      "output_5_status",
      "output_6_milestone_name",
      "output_6_system_type_code",
      "output_6_lookup_system_type_code",
      "output_6_config_data_name",
      "output_6_appian_document_id_file_name",
      "output_6_comment",
      "output_6_start_time",
      "output_6_end_time",
      "output_6_status",
      "output_7_milestone_name",
      "output_7_comment",
      "output_7_start_time",
      "output_7_end_time",
      "output_7_status",
      "output_8_milestone_name",
      "output_8_comment",
      "output_8_start_time",
      "output_8_end_time",
      "output_8_status"
      
      
    },
    fieldLabels: {
      "EUC#
(Request#)",
      "EUC Name",
      "Start BD(Timezone)",
      "End BD",
      "Maker(s)",
      "Checker(s)",
      "Status",
      "Process Actual Start Time",
      "Process Aging(Hrs/Mins)",
      "Process End Time",
      "Total Processing Time(Hrs/Mins)",
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[2]),
        "Center",{}),
        if(
          contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[4]),
          "Managed Segment L8",{}),
          if(
            contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[3]),
            "Managed Segment L7",{}),
            if(
              contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[17]),
              "Expected Start Datetime",{}
            ),
            if(
              contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[18]),
              "Expected End Datetime",{}
            ),
  
    
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[19]),
        "Expected Start Datatime (GMT)",{}
      ),
      if(
        contains(touniformstring({local!json.COLUMNS}),#"_a-0000e56b-0831-8000-5261-1bef901bef90_637534"[20]),
        "Expected End Datetime (GMT)",{}
      ),
      "Step Id",
      "Step Name",
      "Milestone Name",
      "Start Time",
      "End Time",
      "Milestone Status",
      "IO Source Milestone Name",
      "IO Source Sys Type Code",
      "IO Source Lookup Sys Type Code",
      "IO Source Config Name",
      "IO Source File Name",
      "IO Source Comment",
      "IO Source Start Time",
      "IO Source End Time",
      "IO Source Status",
      "Parsing Milestone Name",
      "Parsing File Config Name",
      "Parsing Comment",
      "Parsing Start Time",
      "Parsing Status",
      "Data Validation Milestone Name",
      "Data Validation File Name",
      "Data Validation Working File Name",
      "Data Validation Comment",
      "Data Validation Start Time",
      "Data Validation End Time",
      "Data Validation Status",
      "Transformation Milestone Name",
      "Transformation File Name",
      "Transformation Working File Name",
      "Transformation Comment",
      "Transformation Start Time",
      "Transformation End Time",
      "Transformation Status",
      "Output Generation Milestone Name",
      "Output Generation File Config Name",
      "Output Generation output File Name",
      "Output Generation Comment",
      "Output Generation Start Time",
      "Output Generation End Time",
      "Output Generation Status",
      "IO Target Milestone Name",
      "IO Target System Type Code",
      "IO Target Lookup System Type Code",
      "IO Target Config Data Name",
      "IO Target File Name",
      "IO Target Comment",
      "IO Target Start Time",
      "IO Target End Time",
      "IO Target Status",
      "Maker Milestone Name",
      "Maker comment",
      "Maker Start Time",
      "Maker End Time",
      "Maker Status",
      "Checker Milestone Name",
      "Checker Comment",
      "Checker Start Time",
      "Checker End Time",
      "Checker Status"
    },
    datasubset: local!DataSubset
  ),
  local!output
)
</definition>
        <namedTypedValue>
            <name>input</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <preferredEditor>legacy</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
    </rule>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name>Test case 1</a:name>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string">{"CENTER_SEG_MAPPING_ID":"5,1","MAKERS":null,"CHECKERS":null,"EUC_NUMBER":null,"CENTER_ID":null,"MGDSEGL7_ID":null,"MGDSEGL8_ID":null,"PERIOD_FROM":"12/15/2020","PERIOD_TO":"01/14/2021"}</a:value>
                    <a:nameRef>input</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e5c3-a65f-8000-5268-1bef901bef90_768100"/>
        <historyInfo versionUuid="_a-0000e5ea-27a1-8000-5269-1bef901bef90_773906"/>
        <historyInfo versionUuid="_a-0000e5ea-27a1-8000-5269-1bef901bef90_774642"/>
    </history>
</contentHaul>
