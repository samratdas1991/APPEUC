<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e5c3-a65f-8000-5268-1bef901bef90_766554</versionUuid>
    <interface>
        <name>EAP_DwfMilestoneConfigEditableGrid</name>
        <uuid>_a-0000e505-ae05-8000-525c-1bef901bef90_425894</uuid>
        <description>Holds dwf milestone config editable grid.</description>
        <parentUuid>_a-0000e4c3-7a1b-8000-524f-1bef901bef90_6580</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  local!milestoneId,
  local!nextMilestoneId,
  local!milestoneData: #"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_350906"(
    isActive: 1
   
  ),
 
  local!milestoneConfigData:#"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_354337"(
    isActive: 1,
    milestoneId: local!milestoneId,
    nextMilestoneId:local!nextMilestoneId
  ),
 
  local!activeStep:0,
  {
  
    #"SYSTEM_SYSRULES_sectionLayout_v1"(
      label: "Manage Milestone Configuration",
      contents: {
        #"SYSTEM_SYSRULES_richTextDisplayField"(),
        #"SYSTEM_SYSRULES_columnsLayout"(
          columns: {
            #"SYSTEM_SYSRULES_columnLayout"(
            contents: {
              #"SYSTEM_SYSRULES_dropdownField"(
               label:"Milestone",
               placeholderLabel:"--Enter Milestone--",
               choiceLabels:local!milestoneData.name,
               choiceValues: local!milestoneData.milestone_id,
               value: local!milestoneId,
               saveInto: {local!milestoneId,
               a!save(ri!milestoneConfig,
               #"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_354337"(
                 milestoneId :local!milestoneId
               ))
               },
               showWhen: local!activeStep=0
              )
            }
          ),
          #"SYSTEM_SYSRULES_columnLayout"(
            contents: {
              #"SYSTEM_SYSRULES_dropdownField"(
                label:"Next Milestone",
                placeholderLabel:"--Enter Next Milestone--",
                choiceLabels:difference(touniformstring(local!milestoneData.name),"Run Config"),
                choiceValues: difference(tointeger(local!milestoneData.milestone_id),1),
                value: local!nextMilestoneId,
                saveInto: {local!nextMilestoneId,
                a!save(ri!milestoneConfig,
                #"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_354337"(
                  nextMilestoneId :local!nextMilestoneId
                ))
                },
                showWhen: local!activeStep=0
              )
            }
          ),
          #"SYSTEM_SYSRULES_columnLayout"(),
          #"SYSTEM_SYSRULES_columnLayout"(),
          #"SYSTEM_SYSRULES_columnLayout"(
            contents: #"SYSTEM_SYSRULES_ButtonLayout"(
           
              secondaryButtons: #"SYSTEM_SYSRULES_ButtonWidget"(
                label: "Edit Configuration",
                style: "PRIMARY",
             value:1,
                validate: false(),
                disabled: if(
                  or(and(
                    #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(local!milestoneId),
                    #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(local!nextMilestoneId)
                  ),#"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(local!milestoneConfigData)),
                  true(),
                  false()
                ),
                saveInto:{ 
                  local!activeStep,
                  
                a!save(ri!milestoneConfig,
                #"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_354337"(
                  milestoneId:local!milestoneId,
                  nextMilestoneId: local!nextMilestoneId
                ))
                },
                showWhen: and(local!activeStep=0,
                #"urn:appian:function:v1:fn:isusermemberofgroup?okey=isusermemberofgroup"(
                  loggedInUser(),#"_a-0000e5c3-a65f-8000-5268-1bef901bef90_766304"
                )
                
                )
              )
            )
          )
          
          }
        ),
        #"SYSTEM_SYSRULES_gridField_v1"(
          data: local!milestoneConfigData,
          columns: {
            #"SYSTEM_SYSRULES_gridColumn"(
              label: "Milestone",
              sortField :"milestone_id",
              value: if(
                #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                  index(index(local!milestoneData,
                  wherecontains(
                    tointeger(index(fv!row,"milestone_id",{})),
                    tointeger(index(local!milestoneData,"milestone_id",{}))
                  ),{}
                  ),"name",{})
              ),
                "N/A",
                index(index(local!milestoneData,
                wherecontains(
                  tointeger(index(fv!row,"milestone_id",{})),
                  tointeger(index(local!milestoneData,"milestone_id",{}))
                ),{}
                ),"name",{})
            )),
            #"SYSTEM_SYSRULES_gridColumn"(
              label: "Next Milestone ",
              sortField :"next_milestone_id",
              value: if(
                #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                  index(index(local!milestoneData,
                  wherecontains(
                    tointeger(index(fv!row,"next_milestone_id",{})),
                    tointeger(index(local!milestoneData,"milestone_id",{}))
                  ),{}
                  ),"name",{})
                ),
                "N/A",
                index(index(local!milestoneData,
                wherecontains(
                  tointeger(index(fv!row,"next_milestone_id",{})),
                  tointeger(index(local!milestoneData,"milestone_id",{}))
                ),{}
                ),"name",{})
              )
            ),
            #"SYSTEM_SYSRULES_gridColumn"(
              label: "Is Active",
              sortField :"is_active",
              value:  #"SYSTEM_SYSRULES_imageField_v1"(
                images: {
                  #"SYSTEM_SYSRULES_documentImage"(
                    document: #"SYSTEM_SYSRULES_iconIndicator"(
                      icon: if(
                        contains(
                          toboolean(
                            index(fv!row, "is_active", {})
                          ),
                          true()
                        ),
                        "STATUS_OK",
                        "STATUS_NOTDONE"
                      )
                    ),
                    caption: if(
                      contains(
                        toboolean(
                          index(fv!row, "is_active", {})
                        ),
                        true()
                      ),
                      "Active",
                      "In-Active"
                    )
                  )
                }
              ),
              align: "CENTER",
              width:"NARROW"
            )
          },
          showWhen: or(local!activeStep)=0
        ),
        #"SYSTEM_SYSRULES_richTextDisplayField"(
          value: #"SYSTEM_SYSRULES_richTextItem_v1"(
            text: "+ Add Milestone Configurations",
            link: if(tointeger(local!activeStep)=0,
            #"SYSTEM_SYSRULES_dynamicLink"(
              value: 1,
              saveInto: {local!activeStep,
              a!save(ri!milestoneConfig,#"_a-0000e4e9-ef8d-8000-5259-1bef901bef90_353463"(
           
                isActive: 1,

                createdBy: loggedInUser(),
                createdOn: now()
              ))
              }
            ),
            {}),
            color: if(tointeger(local!activeStep)=0,"ACCENT","SECONDARY"),
            style: "STRONG"
          ),
          showWhen: and(tointeger(local!activeStep)=0,
          #"urn:appian:function:v1:fn:isusermemberofgroup?okey=isusermemberofgroup"(loggedInUser(),#"_a-0000e5c3-a65f-8000-5268-1bef901bef90_766304")
          )
        ),
        if(
         tointeger(local!activeStep)=1,
         {
           
           #"SYSTEM_SYSRULES_gridLayout"(
           label: " ",
           labelPosition: "ABOVE",
           headerCells: {
             #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(
               label: "Milestone",
               align: "LEFT"
             ),
             #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(
               label: "Next Milestone",
               align: "LEFT"
             ),
             #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(
               label: "Is Active",
               align: "CENTER"
             )

           },
           columnConfigs: {
             #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(
               width: "DISTRIBUTE"
             ),
             #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(
               width: "DISTRIBUTE"
             ),
             #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(
               width: "ICON"
             )
           },
           rows: {
             #"SYSTEM_SYSRULES_forEach"(
               items: ri!milestoneConfig,
               expression: #"SYSTEM_SYSRULES_gridRowLayout"(
                 contents: {
                   /* Milestone */
                   #"SYSTEM_SYSRULES_dropdownField"(
                     label: "Milestone",
                     placeholderLabel: "--Select Milestone--",
                     choiceLabels: local!milestoneData.name,
                     choiceValues:local!milestoneData.milestone_id,
                     saveInto: {
                       fv!item.milestone_id,
                       a!save(
                         fv!item.modified_by,
                         loggedInUser()
                       ),
                       a!save(
                         fv!item.modified_on,
                         now()
                       )
                     },
                     
                     value:    if(
                       #"_a-0000e4c6-e892-8000-5254-1bef901bef90_47169"(
                         value: index(
                           fv!item,
                           "milestone_id",
                           {}
                         ),
                         choiceValue:local!milestoneData.milestone_id
                       ),
                       index(
                         fv!item,
                         "milestone_id",
                         {}
                       ),
                       null
                     ),
                     readOnly: ri!isReadOnly,
                     required: if(
                       or(
                         ri!isReadOnly
                       ),
                       false(),
                       true()
                     )
                   ),


                   /* Next Milestone */
                   #"SYSTEM_SYSRULES_dropdownField"(
                     label: "Next Milestone",
                     placeholderLabel: "--Select Next Milestone--",

                     validations:if(
                       or(#"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(
                         fv!item.next_milestone_id
                       )),
                       {},
                       with(
                         local!data:fv!item,

                         if(
                           or(contains(
                             toboolean(#"SYSTEM_SYSRULES_forEach"(
                               items: remove(ri!milestoneConfig,fv!index),
                               expression: and(
                                 tointeger(fv!item.milestone_id)=tointeger(local!data.milestone_id),
                                 tointeger(fv!item.next_milestone_id)=tointeger(local!data.next_milestone_id)
                               )
                             )),
                             true()),
                             contains(
                               toboolean(#"SYSTEM_SYSRULES_forEach"(
                                 items: remove(local!milestoneConfigData,
                                 wherecontains(
                                   tointeger(index(ri!milestoneConfig,"milestone_config_id",{})),
                                   tointeger(index(local!milestoneConfigData,"milestone_config_id",{}))
                                 )),
                                 expression: and(
                                   tointeger(fv!item.milestone_id)=tointeger(local!data.milestone_id),
                                   tointeger(fv!item.next_milestone_id)=tointeger(local!data.next_milestone_id)
                                 )
                               )),
                               true())),
                             "Duplicate Values Found",
                             {}
                         ))

                     ),
                     
                     choiceLabels: difference(touniformstring(local!milestoneData.name),"Run Config")
                     ,
                     choiceValues:difference(tointeger(local!milestoneData.milestone_id),1),
                     saveInto: {
                       fv!item.next_milestone_id,
                       a!save(
                         fv!item.modified_by,
                         loggedInUser()
                       ),
                       a!save(
                         fv!item.modified_on,
                         now()
                       )
                     },
                     value:    if(
                       #"_a-0000e4c6-e892-8000-5254-1bef901bef90_47169"(
                         value: index(
                           fv!item,
                           "next_milestone_id",
                           {}
                         ),
                         choiceValue:local!milestoneData.milestone_id
                       ),
                       index(
                         fv!item,
                         "next_milestone_id",
                         {}
                       ),
                       null
                     ),
                     readOnly: ri!isReadOnly,
                     required: if(
                       or(
                         ri!isReadOnly
                       ),
                       false(),
                       true()
                     ),

                   ),



                   /* Is Active */
                   #"SYSTEM_SYSRULES_richTextDisplayField"(
                     value: {
                       if(
                         or(
                           tointeger(
                             index(
                               fv!item,
                               "is_active",
                               {}
                             )
                           ) = 1
                         ),
                         #"SYSTEM_SYSRULES_richTextIcon"(
                           linkStyle: "STANDALONE",
                           icon: "toggle-on",
                           caption: "Yes",
                           link: #"SYSTEM_SYSRULES_dynamicLink"(
                             showWhen: not(
                               or(
                                 ri!isReadOnly
                               )
                             ),
                             value: 1,
                             saveInto: {a!save(
                               fv!item.is_active,
                               0
                             ),
                             a!save(
                               fv!item.modified_by,
                               loggedInUser()
                             ),
                             a!save(
                               fv!item.modified_on,
                               now()
                             )
                             }
                           ),
                           size: "MEDIUM_PLUS",
                           color: "ACCENT"
                         ),
                         #"SYSTEM_SYSRULES_richTextIcon"(
                           linkStyle: "STANDALONE",
                           icon: "toggle-off",
                           caption: "No",
                           link: #"SYSTEM_SYSRULES_dynamicLink"(
                             showWhen: not(
                               or(
                                 ri!isReadOnly
                               )
                             ),
                             value: 0,
                             saveInto: {a!save(
                               fv!item.is_active,
                               1
                             ),
                             a!save(
                               fv!item.modified_by,
                               loggedInUser()
                             ),
                             a!save(
                               fv!item.modified_on,
                               now()
                             )
                             }
                           ),
                           size: "MEDIUM_PLUS",
                           color: "ACCENT"
                         )
                       )
                     },
                     align: "CENTER"
                   )
                 }
               )
             )
           },
           selectionSaveInto: {},
           addRowLink: {}
         )},
          {}
        )
        ,
        
        #"SYSTEM_SYSRULES_richTextDisplayField"(),
        #"SYSTEM_SYSRULES_ButtonLayout"(
          primaryButtons: {
            if(
              local!activeStep=1,
              #"SYSTEM_SYSRULES_ButtonWidget"(
                label:"Save",
                style:"PRIMARY",
                submit:true(),
                validate:true(),
                saveInto: a!save(ri!buttonAction,#"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[4])
              ),
              {}
              /*
              a!buttonWidget(
                label:"Submit",
                style:"PRIMARY",
                submit:true(),
                validate:true(),
                saveInto: a!save(ri!buttonAction,cons!EAP_BUTTON_ACTION[1])
              )
              */
            )},
          secondaryButtons:{
            if(
              local!activeStep=1,
              #"SYSTEM_SYSRULES_ButtonWidget"(
                label:"Back",
                style:"NORMAL",

                validate:false(),
                saveInto: {a!save(local!activeStep,0),
a!save(ri!milestoneConfig,null)
                }
              ),
              #"SYSTEM_SYSRULES_ButtonWidget"(
                label:"Cancel",
                style:"DESTRUCTIVE",
                submit:true(),
                validate:false(),
                saveInto: a!save(ri!buttonAction,#"_a-0000e4c3-ab68-8000-5250-1bef901bef90_13888"[2])
              )
            )
          }
        )
      }
    )
  }
)</definition>
        <namedTypedValue>
            <name>milestoneConfig</name>
            <type>
                <name>EAP_T_DwfMilestoneConfig?list</name>
                <namespace>urn:com:appian:types:eap</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>isReadOnly</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>buttonAction</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>milestoneId</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>nextMilestoneId</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <history>
        <historyInfo versionUuid="_a-0000e518-940a-8000-525e-1bef901bef90_472247"/>
        <historyInfo versionUuid="_a-0000e518-940a-8000-525e-1bef901bef90_488909"/>
        <historyInfo versionUuid="_a-0000e518-940a-8000-525e-1bef901bef90_519567"/>
        <historyInfo versionUuid="_a-0000e5c3-a65f-8000-5268-1bef901bef90_766554"/>
    </history>
</contentHaul>
