<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e5ac-f704-8000-5264-1bef901bef90_752108</versionUuid>
    <rule>
        <name>EAP_RunConfig_CalculateTriggerTime</name>
        <uuid>_a-0000e4cd-1af4-8000-5255-1bef901bef90_68950</uuid>
        <description>rule to calculate trigger time</description>
        <parentUuid>_a-0000e4c3-7a1b-8000-524f-1bef901bef90_6574</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  local!startBusinessDay:index(
    reject(
      isnull(_),
      split(ri!startbusinesdday,"-")
    ),
    1,
    {}
  ),
  local!nonWorkingDay:ri!nonWorkingDay,
  local!holidayDate:ri!holidayDate,
  local!exceptionWorkingDay:ri!exceptionWorkingDay,
  local!yearlyDateExp: if(
    ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[1],
    if(
      #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!processingMonth),
      {},
    if(
      ri!startbusinesdday&lt;0,
      eomonth(concat("01/01/",year(now())),ri!processingMonth-1)-tointeger(local!startBusinessDay)+1,
      date(year(today()),ri!processingMonth,tointeger(local!startBusinessDay))
    )
    ),
    {}
  ),
  local!yearlyDateTimeExp: if(
    ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[1],
    if(
      #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!processingMonth),
      {},
    if(
      ri!startbusinesdday&lt;0,
      todate(eomonth(concat("01/01/",year(now())),ri!processingMonth-1)-tointeger(local!startBusinessDay)+1),
      date(year(today()),ri!processingMonth,tointeger(local!startBusinessDay))
    )
    ),
    {}
  ),
  local!year:if(
    #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!processingMonth),
    year(today()),
    {
      if(
        month(today())&gt;ri!processingMonth,
        year(today())+1,
        year(today())
      )
    }
  ),
  local!monthlydate:if(
    or(
      #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!processingMonth)
    ),
    todate(
      concat(month(today()),"/1/",local!year)     
    ),
    todate(
      concat(ri!processingMonth,"/1/",local!year)     
    )
  ),
  local!monthlyDateExp: if(
    ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[2],
    if(
      ri!startbusinesdday&lt;0,
      eomonth(todatetime(local!monthlydate),0)-tointeger(local!startBusinessDay)+1,
      date(year(local!monthlydate),tointeger(month(todatetime(local!monthlydate))),tointeger(local!startBusinessDay))
    ),
    {}
  ),
  local!monthlyDateTimeExp: if(
    ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[2],
    if(
      ri!startbusinesdday&lt;0,
      eomonth(addmonths(todatetime(local!monthlydate),ri!recurrenceFrequency),0)-tointeger(local!startBusinessDay)+1,
      date(year(addmonths(todatetime(local!monthlydate),ri!recurrenceFrequency)),tointeger(month(addmonths(todatetime(local!monthlydate),ri!recurrenceFrequency))),tointeger(local!startBusinessDay))
    ),
    {}
  ),
  local!date:if(
    ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[1],
    if(
      or(
        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!triggerTime),
        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!processingMonth),
        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!startbusinesdday),

      ),
      {},
      if(
        or(
          and (
            tointeger(ri!startbusinesdday)&gt;tointeger(0),
            tointeger(ri!startbusinesdday)&lt;tointeger(16)
          ), 
          and(
            tointeger(ri!startbusinesdday)&lt;tointeger(0),
            tointeger(ri!startbusinesdday)&gt;tointeger(-16)
          )
        ),  
        todate(
          if( 
            todate(
              local!yearlyDateExp
            )&lt;today(),
            addyears(
              todatetime(
                local!yearlyDateTimeExp
              ),
              1),
              if(
                or(
                  and(
                    todate(
                      local!yearlyDateExp
                    )=today(),
                    ri!triggerTime&lt;totime(local(now(),ri!timezone))
                  ),
                  toboolean(
                    if(
                      ri!startbusinesdday&lt;0,
                      {
                        if(
                          and(
                            todate(
                              local!yearlyDateExp
                            )=today(),
                            and(
                              or(
                                contains(
                                  tointeger(local!nonWorkingDay),
                                  weekday(
                                    todate(
                                      local!yearlyDateExp
                                    )
                                  )
                                ),
                                contains(
                                  todate(local!holidayDate),
                                  todate(
                                    local!yearlyDateExp
                                  )
                                )

                              ),
                              not(
                                contains(
                                  todate(local!exceptionWorkingDay),
                                  todate(
                                    local!yearlyDateExp
                                  )
                                )
                              )
                            )
                          ),
                          true(),
                          false()
                        )
                      },
                      false()
                    )
                  )
                ),
                addyears(
                  todatetime(
                    local!yearlyDateTimeExp
                  ),
                  1),
                  todate(
                    local!yearlyDateExp
                  )
              )
          )
        ),
        {}
      )
    ),
    if(
      ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[2],
      {
        if(
          or(
            and (
              tointeger(ri!startbusinesdday)&gt;tointeger(0),
              tointeger(ri!startbusinesdday)&lt;tointeger(16)
            ), 
            and(
              tointeger(ri!startbusinesdday)&lt;tointeger(0),
              tointeger(ri!startbusinesdday)&gt;tointeger(-16)
            )
          ),  
          todate(
            if( 
              local!monthlyDateExp&lt;today(),

              todatetime(
                local!monthlyDateTimeExp
              ),
              if(
                or(
                  and(
                    todate(local!monthlyDateExp)=today(),
                    ri!triggerTime&lt;totime(local(now(),ri!timezone))
                  ),
                  toboolean(
                    if(
                      ri!startbusinesdday&lt;0,
                      {
                        if(
                          and(
                            todate(local!monthlyDateExp)=today(),
                            and(
                              or(
                                contains(
                                  tointeger(local!nonWorkingDay),
                                  weekday(
                                    todate(local!monthlyDateExp)
                                  )
                                ),
                                contains(
                                  todate(local!holidayDate),
                                  todate(local!monthlyDateExp)
                                )

                              ),
                              not(
                                contains(
                                  todate(local!exceptionWorkingDay),
                                  todate(local!monthlyDateExp)
                                )
                              )
                            )
                          ),
                          true(),
                          false()
                        )
                      },
                      false()
                    )
                  )
                ),

                todatetime(
                  local!monthlyDateTimeExp
                ),
                todate(local!monthlyDateExp)
              )
            )
          ),
          {}
        )
      },
      if(ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[4],
      if(
        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!triggerTime),
        {},
        if(
          ri!triggerTime&lt;totime(local(now(),ri!timezone)),
          today()+1,
          today()

        )
      ),
      if(ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[3],
      if(
        #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!triggerTime),
        {},
        if(
          and(
            index(
              reject(
                isnull(_),
                #"SYSTEM_SYSRULES_forEach"(
                  items: today()+enumerate(31),
                  expression: 
                  if(
                    contains(tointeger(ri!processingWeekday),weekday(fv!item)),
                    fv!item,
                    null
                  )

                )
              ),
              1,
              {}
            )=today(),
            ri!triggerTime&lt;totime(local(now(),ri!timezone)),
          ),
          index(
            reject(
              isnull(_),
              #"SYSTEM_SYSRULES_forEach"(
                items: today()+enumerate(31)+1,
                expression: 
                if(
                  contains(tointeger(ri!processingWeekday),weekday(fv!item)),
                  fv!item,
                  null
                )

              )
            ),
            1,
            {}
          ),
          index(
            reject(
              isnull(_),
              #"SYSTEM_SYSRULES_forEach"(
                items: today()+enumerate(31),
                expression: 
                if(
                  contains(tointeger(ri!processingWeekday),weekday(fv!item)),
                  fv!item,
                  null
                )

              )
            ),
            1,
            {}
          )
        )
      ),
      {}
      )
      )
    )
  ),
  if(
    or(
      #"_a-0000e4cd-1af4-8000-5255-1bef901bef90_80228"(ri!recurrenceType)

    ),
    {},
    if(
      ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[1],
      if(
        or(
          and (
            tointeger(ri!startbusinesdday)&gt;tointeger(0),
            tointeger(ri!startbusinesdday)&lt;tointeger(16)
          ), 
          and(
            tointeger(ri!startbusinesdday)&lt;tointeger(0),
            tointeger(ri!startbusinesdday)&gt;tointeger(-16)
          )
        ),

        {
          if(

            or(
              #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!triggerTime),
              #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!processingMonth),
              #"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!startbusinesdday)

            )

            ,
            {},
            index(
              reject(
                isnull(_),
                #"SYSTEM_SYSRULES_forEach"(
                  items: if(
                    ri!startbusinesdday&lt;0,
                    local!date-enumerate(30),
                    local!date+enumerate(30)
                  ),
                  expression: if(
                    and(
                      or(
                        contains(
                          tointeger(local!nonWorkingDay),
                          weekday(fv!item)
                        ),
                        contains(
                          todate(local!holidayDate),
                          todate(fv!item)
                        )

                      ),
                      not(
                        contains(
                          todate(local!exceptionWorkingDay),
                          todate(fv!item)
                        )
                      )
                    ),
                    null,
                    fv!item
                  )
                )
              ),
              1,
              {}
            )
          )
        },
        {}
      ),
      if(ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[2],
      {
        if(
          or(
            and (
              tointeger(ri!startbusinesdday)&gt;tointeger(0),
              tointeger(ri!startbusinesdday)&lt;tointeger(16)
            ), 
            and(
              tointeger(ri!startbusinesdday)&lt;tointeger(0),
              tointeger(ri!startbusinesdday)&gt;tointeger(-16)
            )
          ),  
          index(
            reject(
              isnull(_),
              #"SYSTEM_SYSRULES_forEach"(
                items: if(
                  ri!startbusinesdday&lt;0,
                  local!date-enumerate(30),
                  local!date+enumerate(30)
                ),
                expression: if(
                  and(
                    or(
                      contains(
                        tointeger(local!nonWorkingDay),
                        weekday(fv!item)
                      ),
                      contains(
                        todate(local!holidayDate),
                        todate(fv!item)
                      )

                    ),
                    not(
                      contains(
                        todate(local!exceptionWorkingDay),
                        todate(fv!item)
                      )
                    )
                  ),
                  null,
                  fv!item
                )
              )
            ),
            1,
            {}
          ),
          {}
        )
      },
      if(
        or(ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[4]),
        {
          index(
            reject(
              isnull(_),
              #"SYSTEM_SYSRULES_forEach"(
                items: todate(local!date)+enumerate(30),
                expression: if(
                  and(
                    or(
                      contains(
                        tointeger(local!nonWorkingDay),
                        weekday(fv!item)
                      ),
                      contains(
                        todate(local!holidayDate),
                        todate(fv!item)
                      )

                    ),
                    not(
                      contains(
                        todate(local!exceptionWorkingDay),
                        todate(fv!item)
                      )
                    )
                  ),
                  null,
                  fv!item
                )
              )
            ),
            1,
            {}
          )
        },
        {
          if(and(ri!recurrenceType=#"_a-0000e4c6-e892-8000-5254-1bef901bef90_22735"[3],#"_a-0000e4b2-6487-8000-2b63-01ef9001ef90_3233095"(ri!processingWeekday)),
          {},
          {
            index(
              reject(
                isnull(_),
                #"SYSTEM_SYSRULES_forEach"(
                  items: todate(local!date)+enumerate(30),
                  expression: if(
                    and(
                      or(
                        contains(
                          tointeger(local!nonWorkingDay),
                          weekday(fv!item)
                        ),
                        contains(
                          todate(local!holidayDate),
                          todate(fv!item)
                        )

                      ),
                      not(
                        contains(
                          todate(local!exceptionWorkingDay),
                          todate(fv!item)
                        )
                      )
                    ),
                    null,
                    fv!item
                  )
                )
              ),
              1,
              {}
            )
          }
          )
        }
      )
      )

    )
  )

)
</definition>
        <namedTypedValue>
            <name>startbusinesdday</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>processingMonth</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>recurrenceType</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>processingWeekday</name>
            <type>
                <name>Text?list</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>nonWorkingDay</name>
            <type>
                <name>Integer?list</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>holidayDate</name>
            <type>
                <name>Date?list</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>exceptionWorkingDay</name>
            <type>
                <name>Date?list</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>triggerTime</name>
            <type>
                <name>time</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>timezone</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>recurrenceFrequency</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>legacy</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
    </rule>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <history>
        <historyInfo versionUuid="_a-0000e4cd-1af4-8000-5255-1bef901bef90_82669"/>
        <historyInfo versionUuid="_a-0000e4cd-1af4-8000-5255-1bef901bef90_92254"/>
        <historyInfo versionUuid="_a-0000e4cd-1af4-8000-5255-1bef901bef90_161431"/>
        <historyInfo versionUuid="_a-0000e4cd-1af4-8000-5255-1bef901bef90_187939"/>
        <historyInfo versionUuid="_a-0000e4dd-0d8b-8000-5257-1bef901bef90_224034"/>
        <historyInfo versionUuid="_a-0000e4e9-ef8d-8000-5259-1bef901bef90_350069"/>
        <historyInfo versionUuid="_a-0000e4e9-ef8d-8000-5259-1bef901bef90_369038"/>
        <historyInfo versionUuid="_a-0000e5ac-f704-8000-5264-1bef901bef90_752108"/>
    </history>
</contentHaul>
